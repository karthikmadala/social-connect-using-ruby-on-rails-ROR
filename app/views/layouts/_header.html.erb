<nav class="navbar navbar-expand-lg navbar-dark bg-gradient shadow mb-4">
  <div class="container">
    <!-- Brand/Home Link -->
    <a class="navbar-brand" href="<%= root_path %>">Home</a>

    <!-- Toggler Button for Mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Links -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <%= link_to "Users", users_path, class: "nav-link" %>
        </li>

        <% unless current_user&.admin? %>
          <li class="nav-item">
            <%= link_to "Friends", friendships_path, class: "nav-link" %>
          </li>
          <li class="nav-item">
            <%= link_to "Requests", friend_requests_path, class: "nav-link" %>
          </li>
        <% end %>
      </ul>

      <!-- Centered User Name -->
      <% if current_user %>
        <ul class="navbar-nav mx-auto">
          <li class="nav-item">
            <span class="nav-link text-white fw-bold"><%= current_user.full_name %></span>
          </li>
        </ul>
      <% end %>

      <!-- Search Bar -->
      <%= form_with url: users_path, method: :get, local: true, class: "d-flex me-3 position-relative" do %>
        <input class="form-control me-2 search-input" type="search" name="query" placeholder="Search" id="search-input" autocomplete="off">
        <button class="btn btn-outline-light search-button" type="submit">Search</button>
        <div id="search-suggestions" class="dropdown-menu w-100 position-absolute" style="display: none;"></div>
      <% end %>

      <ul class="navbar-nav">
        <% if current_user %>
          <!-- Notifications Dropdown -->
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle position-relative" href="#" role="button" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">ðŸ”” 
            <span class="badge bg-success rounded-pill"><%= unread_count = current_user.notifications.unread.count %></span>
          </a>
            <ul class="dropdown-menu dropdown-menu-end bg-transparent border-0 shadow-none text-light" aria-labelledby="notificationsDropdown">
              <li><h6 class="dropdown-header text-white">Notifications</h6></li>
              <div id="notifications-list" class="overflow-auto" style="max-height: 300px;">
                <% if current_user.notifications.any? %>
                  <%= render partial: "notifications/notifications_list", locals: { notifications: current_user.notifications.limit(5) } %>
                <% else %>
                  <li class="dropdown-item text-muted text-center">No new notifications</li>
                <% end %>
              </div>
              <li><hr class="dropdown-divider"></li>
              <li>
                <%= link_to "View All", notifications_path, class: "dropdown-item text-center text-white" %>
              </li>
            </ul>
          </li>
          <!-- Logout Button -->
          <li class="nav-item">
            <%= link_to "Logout", destroy_user_session_path, method: :delete, class: "btn btn-danger ms-2" %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</nav>

<style>
/* Ensure the dropdown blends seamlessly */
.dropdown-menu {
  background: rgba(0, 0, 0, 0.5) !important; /* Semi-transparent black */
  backdrop-filter: blur(10px); /* Frosted glass effect */
  border-radius: 8px;
}

/* Change item hover effect */
.dropdown-item {
  color: white !important;
}

.dropdown-item:hover {
  background: rgba(255, 255, 255, 0.2) !important; /* Subtle hover effect */
}
</style>