<% @posts.each do |post| %>
    <li class="list-group-item mb-3">
      <!-- Post Header -->
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="d-flex align-items-center">
          <% if post.user.avatar.attached? %>
            <%= image_tag post.user.avatar, class: "rounded-circle me-2", width: 40, height: 40 %>
          <% else %>
            <%= image_tag "default_avatar.png", class: "rounded-circle me-2", width: 40, height: 40 %>
          <% end %>
          
          <div>
            <strong><%= post.user.email %></strong><br>
            <small class="text-muted"><%= time_ago_in_words(post.created_at) %> ago</small>
          </div>
        </div>

        <!-- Delete Post Button (Visible to Post Creator) -->
        <% if post.user == current_user %>
          <%= button_to "Delete Post", post_path(post), method: :delete, class: "btn btn-danger btn-sm" %>
        <% end %>
      </div>

      <!-- Post Content -->
      <p><%= post.content %></p>

      <!-- Media Files -->
      <% if post.media_files.attached? %>
        <div class="d-flex flex-wrap gap-2">
          <% post.media_files.each do |file| %>
            <% if file.content_type.start_with?('image') %>
              <%= image_tag file, class: "img-fluid rounded", style: "max-width: 100%; height: auto;" %>
            <% elsif file.content_type.start_with?('video') %>
              <%= video_tag url_for(file), controls: true, autoplay: true, muted: true, loop: true, class: "img-fluid rounded", style: "max-width: 100%; height: auto;" %>
            <% end %>
          <% end %>
        </div>
      <% end %>

      <!-- Like and Comment Buttons -->
      <div class="mt-2">
        <%= render "posts/like_button",post: post%>
        <%= link_to "ðŸ’¬ Comment", "#comment-section-#{post.id}", class: "btn btn-outline-secondary btn-sm" %>
      </div>

      <!-- Comments Section -->
        <%=render "posts/comment", post: post%>
    </li>
  <% end %>
