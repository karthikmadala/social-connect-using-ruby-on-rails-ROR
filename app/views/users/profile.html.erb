<% if user_signed_in? %>
  <div class="container mt-4">
    <h1 class="text-center text-white mb-4"><%= @user.full_name %>'s Profile</h1>

    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card shadow-sm glass-container text-white">
          <div class="card-body text-center">
            <% if @user.avatar.attached? %>
              <%= image_tag @user.avatar.variant(resize_to_limit: [150, 150]).processed, class: "rounded-circle img-thumbnail mb-3 border border-white" %>
            <% else %>
              <%= image_tag "default-user.jpg", class: "rounded-circle img-thumbnail mb-3 border border-white", alt: "Default User", width: 150, height: 150 %>
            <% end %>

            <h5 class="card-title"><%= @user.full_name %></h5>
            <p class="text-muted">Email: <%= @user.email %></p>
            <% if @user.phone.present? %>
              <p class="text-muted">Phone: <%= @user.phone %></p>
            <% end %>

            <% if current_user != @user && current_user.friends.include?(@user) %>
              <%= button_to 'Unfriend', unfriend_friendships_path(friend_id: @user.id),
                                        method: :delete,
                                        class: 'btn btn-danger btn-sm me-4 w-50 btn-gradient' %>
            <% end %>

            <h4 class="text-white mt-4">Friends</h4>
            <% if @user.friends.any? %>
              <div class="row">
                <% @user.friends.each do |friend| %>
                  <div class="col-md-4 mb-4">
                    <div class="card shadow-sm glass-container text-white">
                      <div class="card-body text-center">
                        <% if friend.avatar.attached? %>
                          <%= image_tag friend.avatar.variant(resize_to_limit: [100, 100]).processed, class: "rounded-circle img-thumbnail mb-3 border border-white" %>
                        <% else %>
                          <%= image_tag "default-user.jpg", class: "rounded-circle img-thumbnail mb-3 border border-white", alt: "Default User", width: 100, height: 100 %>
                        <% end %>

                        <h6 class="card-title"><%= friend.full_name %></h6>
                        <p class="text-muted"><%= friend.email %></p>

                        <div class="d-flex justify-content-center align-items-center flex-wrap">

                          <%= link_to "View Profile", profile_user_path(friend), class: "btn btn-info btn-sm btn-gradient me-1 mb-1" %>

                          <% unless current_user.admin? %>
                            <% if current_user.friends.include?(friend) %>
                              <span class="badge bg-success mb-1">âœ… Friends</span>
                            <% elsif current_user.sent_friend_requests.exists?(friend_id: friend.id) %>
                              <div class="mb-1">
                                <%= button_to 'Cancel Request', unfriend_friendships_path(friend_id: friend.id),
                                                              method: :delete,
                                                              class: 'btn btn-warning btn-sm btn-gradient' %>
                              </div>
                            <% else %>
                              <%= button_to "Add Friend", friendships_path(friend_id: friend.id), method: :post, class: "btn btn-primary btn-sm btn-gradient mb-1" %>
                            <% end %>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="text-muted">No friends yet.</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>