<div class="container mt-4">
  <h1 class="text-center my-4 text-white">All Users</h1>

  <div class="row justify-content">
    <% @users.each do |user| %>
      <% unless user == current_user || user.admin? %>
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm glass-container">
            <div class="card-body text-center">
              <% if user.avatar.attached? %>
                <%= image_tag user.avatar.variant(resize_to_limit: [100, 100]).processed, class: "rounded-circle img-thumbnail mb-3 border-white" %>
              <% else %>
                <%= image_tag "default-user.jpg", class: "rounded-circle img-thumbnail mb-3 border-white", alt: "Default User", width: 100, height: 100 %>
              <% end %>

              <h5 class="card-title text-white"><%= user.first_name %> <%= user.last_name %></h5>
              <p class="text-muted"><%= user.email %></p>

              <% unless current_user.admin? %>
                <% if current_user.friends.include?(user) %>
                  <span class="badge bg-success">✅ Friends</span>
                <% elsif current_user.sent_friend_requests.exists?(friend_id: user.id) %>
                  <span class="badge bg-warning">Friend request sent ✅</span>
                  <div class="mt-3">
                    <%= button_to 'Cancel Request', unfriend_friendships_path(friend_id: user.id), 
                          method: :delete, 
                          data: { confirm: 'Are you sure?' }, 
                          class: 'btn btn-warning btn-sm w-100 btn-gradient' %>
                  </div>
                <% else %>
                  <%= button_to "Add Friend", friendships_path(friend_id: user.id), method: :post, class: "btn btn-primary btn-sm mt-2 btn-gradient" %>
                <% end %>
              <% end %>

              <% if current_user.admin? %>
                <div class="mt-3 d-flex justify-content-center">
                  <%= link_to "View Profile", profile_user_path(user), class: "btn btn-info btn-sm me-2 btn-gradient" %>
                  <%= button_to "Delete User", user_path(user), method: :delete, data: { confirm: "Are you sure you want to delete this user?" }, class: "btn btn-danger btn-sm btn-gradient" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
