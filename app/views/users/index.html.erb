<div class="container mt-4">
  <h1 class="text-center my-4">All Users</h1>

  <div class="row">
    <% @users.each do |user| %>
      <% unless user == current_user || user.admin? %> 
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm">
            <div class="card-body text-center">
              <% if user.avatar.attached? %>
                <%= image_tag user.avatar.variant(resize_to_limit: [100, 100]).processed, class: "rounded-circle img-thumbnail mb-3" %>
              <% else %>
                <%= image_tag "default-user.jpg", class: "rounded-circle img-thumbnail mb-3", alt: "Default User", width: 100, height: 100 %>
              <% end %>

              <h5 class="card-title"><%= user.first_name %> <%= user.last_name %></h5>
              <p class="text-muted"><%= user.email %></p>

              <% if !current_user.admin? %> 
                <!-- Only show friendship status for non-admins -->
                <% if current_user.friends.include?(user) %>
                  <span class="badge bg-success">✅ Friends</span>
                <% elsif current_user.sent_friend_requests.exists?(friend_id: user.id) %>
                  <span class="badge bg-warning">Friend request sent ✅</span>
                <% else %>
                  <%= button_to "Add Friend", friendships_path(friend_id: user.id), method: :post, class: "btn btn-primary btn-sm mt-2" %>
                <% end %>
              <% end %>

              <% if current_user.admin? %>
                <div class="mt-3 d-flex justify-content-center">
                  <%= link_to "View Profile", user_path(user), class: "btn btn-info btn-sm me-2" %>
                  <%= button_to "Delete User", user_path(user), method: :delete, data: { confirm: "Are you sure you want to delete this user?" }, class: "btn btn-danger btn-sm" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
